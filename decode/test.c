#include <stdio.h>
#include <stdint.h>

#include "dav1d/dav1d.h"

// gcc test.c -Idav1d/include -ldav1d -Ldav1d/lib

uint8_t framedata[] = {10, 12, 32, 0, 0, 0, 143, 159, 255, 52, 4, 52, 0, 128, 50, 25, 16, 0, 191, 0, 0, 2, 71, 128, 2, 197, 197, 249, 197, 230, 143, 255, 118, 119, 34, 30, 9, 197, 234, 167, 128, 50, 67, 48, 3, 192, 128, 0, 0, 70, 191, 0, 0, 2, 67, 247, 2, 128, 0, 160, 202, 48, 223, 255, 255, 186, 120, 67, 170, 138, 223, 244, 150, 11, 81, 191, 134, 230, 163, 107, 1, 116, 210, 17, 170, 250, 255, 248, 192, 7, 243, 195, 23, 169, 95, 150, 81, 28, 183, 248, 26, 53, 41, 110, 31, 182, 254, 82, 197, 255, 50, 38, 48, 5, 193, 4, 0, 0, 70, 192, 0, 0, 2, 130, 118, 0, 128, 0, 237, 124, 127, 46, 121, 127, 254, 139, 157, 145, 195, 71, 250, 255, 24, 191, 164, 9, 139, 100, 240, 205, 50, 19, 48, 6, 66, 8, 128, 0, 70, 155, 128, 0, 2, 3, 128, 0, 128, 0, 133, 29, 136, 50, 25, 48, 8, 68, 13, 16, 0, 70, 140, 128, 0, 2, 3, 128, 0, 128, 0, 254, 80, 46, 171, 60, 232, 108, 48, 148, 50, 18, 48, 10, 72, 17, 160, 64, 70, 139, 128, 0, 2, 2, 0, 0, 128, 0, 37, 63, 50, 18, 48, 12, 80, 22, 48, 136, 70, 139, 128, 0, 2, 0, 0, 0, 128, 0, 138, 152, 50, 18, 48, 14, 96, 26, 192, 209, 70, 140, 0, 0, 2, 0, 0, 0, 128, 0, 149, 16, 50, 18, 48, 16, 64, 159, 81, 26, 70, 140, 0, 0, 2, 0, 0, 0, 128, 0, 136, 32, 50, 18, 48, 18, 65, 7, 225, 99, 70, 140, 128, 0, 2, 0, 0, 0, 128, 0, 145, 128, 50, 18, 48, 20, 66, 8, 241, 172, 70, 140, 128, 0, 2, 0, 0, 0, 128, 0, 134, 128, 50, 17, 48, 22, 68, 13, 17, 245, 70, 141, 0, 0, 2, 0, 0, 0, 128, 0, 143, 50, 17, 48, 24, 72, 17, 160, 126, 70, 141, 0, 0, 2, 0, 0, 0, 128, 0, 133, 50, 17, 48, 26, 80, 22, 48, 143, 70, 141, 128, 0, 2, 0, 0, 0, 128, 0, 139, 50, 17, 48, 28, 96, 26, 192, 209, 70, 142, 0, 0, 2, 0, 0, 0, 128, 0, 129, 50, 17, 48, 30, 64, 159, 81, 26, 70, 143, 0, 0, 2, 0, 0, 0, 128, 0, 134, 50, 17, 48, 32, 65, 7, 225, 99, 70, 143, 0, 0, 2, 0, 0, 0, 128, 0, 130, 50, 17, 48, 34, 66, 8, 241, 172, 70, 143, 128, 0, 2, 0, 0, 0, 128, 0, 134, 50, 17, 48, 36, 68, 13, 17, 245, 70, 144, 0, 0, 2, 0, 0, 0, 128, 0, 126, 50, 17, 48, 38, 72, 17, 160, 126, 70, 144, 128, 0, 2, 0, 0, 0, 128, 0, 132, 50, 17, 48, 40, 80, 22, 48, 143, 70, 145, 0, 0, 2, 0, 0, 0, 128, 0, 124, 50, 17, 48, 42, 96, 26, 192, 209, 70, 146, 128, 0, 2, 0, 0, 0, 128, 0, 124, 50, 17, 48, 44, 64, 159, 81, 26, 70, 147, 0, 0, 2, 0, 0, 0, 128, 0, 124, 50, 17, 48, 46, 65, 7, 225, 99, 70, 148, 0, 0, 2, 0, 0, 0, 128, 0, 120, 50, 17, 48, 48, 66, 8, 241, 172, 70, 149, 128, 0, 2, 0, 0, 0, 128, 0, 116, 50, 17, 48, 50, 68, 13, 17, 245, 70, 150, 128, 0, 2, 0, 0, 0, 128, 0, 120, 50, 17, 48, 52, 72, 17, 160, 126, 70, 151, 128, 0, 2, 0, 0, 0, 128, 0, 120, 50, 17, 48, 54, 80, 22, 48, 143, 70, 153, 128, 0, 2, 0, 0, 0, 128, 0, 120, 50, 17, 48, 56, 96, 26, 192, 209, 70, 155, 128, 0, 2, 0, 0, 0, 128, 0, 120, 50, 17, 48, 58, 64, 159, 81, 26, 70, 158, 0, 0, 2, 0, 0, 0, 128, 0, 120, 50, 17, 48, 60, 65, 7, 225, 99, 70, 161, 128, 0, 2, 64, 0, 0, 128, 0, 120, 50, 17, 48, 62, 66, 8, 241, 172, 70, 166, 0, 0, 2, 64, 0, 0, 128, 0, 112, 50, 18, 48, 65, 196, 13, 17, 245, 70, 192, 0, 0, 2, 128, 0, 0, 128, 0, 149, 48, 50, 18, 48, 67, 8, 13, 24, 62, 70, 138, 0, 0, 2, 0, 0, 0, 128, 0, 144, 176, 50, 17, 48, 68, 80, 17, 170, 15, 70, 138, 128, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 71, 96, 26, 58, 17, 70, 138, 128, 0, 2, 0, 0, 0, 128, 0, 104, 50, 17, 48, 72, 64, 159, 74, 26, 70, 139, 128, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 74, 65, 7, 234, 35, 70, 139, 128, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 76, 66, 8, 250, 52, 70, 139, 128, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 78, 80, 13, 26, 60, 70, 140, 0, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 80, 96, 25, 170, 12, 70, 140, 0, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 82, 64, 159, 58, 20, 70, 140, 128, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 84, 65, 7, 234, 28, 70, 140, 128, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 86, 66, 8, 250, 52, 70, 141, 0, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 88, 80, 13, 26, 60, 70, 141, 0, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 90, 96, 25, 170, 12, 70, 141, 128, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 92, 64, 159, 58, 20, 70, 142, 0, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 94, 65, 7, 234, 28, 70, 142, 0, 0, 2, 0, 0, 0, 128, 0, 112, 50, 17, 48, 96, 66, 8, 250, 52, 70, 143, 0, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 98, 80, 13, 26, 60, 70, 143, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 100, 96, 25, 170, 12, 70, 144, 0, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 102, 64, 159, 58, 20, 70, 144, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 104, 65, 7, 234, 28, 70, 145, 0, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 106, 66, 8, 250, 52, 70, 145, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 108, 80, 13, 26, 60, 70, 146, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 110, 96, 25, 170, 12, 70, 147, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 112, 64, 159, 58, 20, 70, 148, 0, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 114, 65, 7, 234, 28, 70, 149, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 116, 66, 8, 250, 52, 70, 150, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 118, 80, 13, 26, 60, 70, 151, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 120, 96, 25, 170, 12, 70, 153, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 122, 64, 159, 58, 20, 70, 155, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 124, 65, 7, 234, 28, 70, 158, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 126, 66, 8, 250, 52, 70, 161, 128, 0, 2, 64, 0, 0, 128, 0, 96, 50, 17, 48, 128, 80, 13, 26, 60, 70, 166, 0, 0, 2, 64, 0, 0, 128, 0, 96, 50, 18, 48, 131, 160, 25, 170, 12, 70, 192, 0, 0, 2, 128, 0, 0, 128, 0, 152, 64, 50, 18, 48, 133, 64, 153, 174, 44, 70, 138, 0, 0, 2, 0, 0, 0, 128, 0, 147, 192, 50, 17, 48, 134, 65, 31, 50, 172, 70, 138, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 137, 2, 11, 226, 236, 70, 139, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 138, 80, 13, 115, 172, 70, 139, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 140, 65, 25, 163, 236, 70, 139, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 142, 66, 11, 51, 236, 70, 140, 0, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 144, 80, 13, 99, 236, 70, 140, 0, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 146, 65, 25, 163, 236, 70, 140, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 148, 66, 11, 51, 236, 70, 140, 128, 0, 2, 0, 0, 0, 128, 0, 96, 50, 17, 48, 150, 80, 13, 99, 236, 70, 141, 0, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 152, 65, 25, 163, 236, 70, 141, 0, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 154, 66, 11, 51, 236, 70, 141, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 156, 80, 13, 99, 236, 70, 142, 0, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 158, 65, 25, 163, 236, 70, 142, 0, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 160, 66, 11, 51, 236, 70, 143, 0, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 162, 80, 13, 99, 236, 70, 143, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 164, 65, 25, 163, 236, 70, 144, 0, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 166, 66, 11, 51, 236, 70, 144, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 168, 80, 13, 99, 236, 70, 145, 0, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 170, 65, 25, 163, 236, 70, 145, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 172, 66, 11, 51, 236, 70, 146, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 174, 80, 13, 99, 236, 70, 147, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 176, 65, 25, 163, 236, 70, 148, 0, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 178, 66, 11, 51, 236, 70, 149, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 180, 80, 13, 99, 236, 70, 150, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 182, 65, 25, 163, 236, 70, 151, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 184, 66, 11, 51, 236, 70, 153, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 186, 80, 13, 99, 236, 70, 156, 0, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 188, 65, 25, 163, 236, 70, 158, 128, 0, 2, 0, 0, 0, 128, 0, 64, 50, 17, 48, 190, 66, 11, 51, 236, 70, 161, 128, 0, 2, 64, 0, 0, 128, 0, 64, 50, 17, 48, 192, 80, 13, 99, 236, 70, 166, 0, 0, 2, 64, 0, 0, 128, 0, 64, 50, 17, 48, 194, 65, 25, 163, 236, 70, 173, 0, 0, 2, 64, 0, 0, 128, 0, 64, 50, 18, 48, 197, 2, 11, 51, 236, 70, 192, 0, 0, 2, 128, 0, 0, 128, 0, 154, 128, 50, 18, 48, 198, 144, 11, 23, 236, 70, 192, 0, 0, 2, 128, 0, 0, 128, 0, 150, 128};

void fake_dealloc(const uint8_t* data, void* cookie) {
    return;
}

int main()
{
    printf("hello world %i\n", DAV1D_PICTURE_ALIGNMENT);

    Dav1dSettings settings = {0};
    dav1d_default_settings(&settings);

    Dav1dContext *context;
    int status = dav1d_open(&context, &settings);
    printf("open status = %i\n", status);

    Dav1dData data = {0};
    status = dav1d_data_wrap(&data, framedata, 2015, fake_dealloc, NULL);
    printf("data wrap status = %i\n", status);

    status = dav1d_send_data(context, &data);
    printf("send data status = %i\n", status);

    Dav1dPicture pic = {0};

    status = dav1d_get_picture(context, &pic);
    printf("get picture status = %i\n", status);

    printf(" DAV1D_ERR(EAGAIN) = %i\n",  DAV1D_ERR(EAGAIN));


    dav1d_close(&context);

    printf("%s\n", dav1d_version());

    return 0;
}